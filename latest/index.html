<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.15"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Google Cloud Spanner C++ Client: Cloud Spanner C++ Client Library</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Google Cloud Spanner C++ Client
   &#160;<span id="projectnumber">1.0.0</span>
   </div>
   <div id="projectbrief">A C++ Client Library for Google Cloud Spanner</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.15 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Cloud Spanner C++ Client Library </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>The Cloud Spanner C++ Client library offers types and functions to use Cloud Spanner from C++11 applications.</p>
<p>This library requires a C++11 compiler, it is supported (and tested) on multiple Linux distributions.</p>
<h2>Quickstart</h2>
<p>The following instructions show you how to perform basic tasks in Cloud Spanner using the C++ client library.</p>
<h3>Before you begin</h3>
<ol type="1">
<li>Select or create a Google Cloud Platform (GCP) project using the <a href="https://console.cloud.google.com/cloud-resource-manager" title="Console Resource Manager">manage resource page</a>. Make a note of the project id, you will need to use it later.</li>
<li>Make sure that <a href="https://cloud.google.com/billing/docs/how-to/modify-project" title="How to: Modify Project">billing is enabled</a> for your project.</li>
<li>Learn about <a href="https://cloud.google.com/storage/docs/concepts" title="GCS Concepts">key terms and concepts</a> for Cloud Spanner.</li>
<li>Setup the authentication for the examples:<ul>
<li><a href="https://cloud.google.com/docs/authentication/getting-started" title="Authentication Getting Started">Configure a service account</a>,</li>
<li>or <a href="https://cloud.google.com/sdk/docs/quickstarts">login with your personal account</a></li>
</ul>
</li>
</ol>
<h3>Setting up your repo</h3>
<p>In order to use the Cloud Spanner C++ client library from your own code, you'll need to teach your build system how to fetch and compile the Cloud C++ client library. The Cloud Spanner C++ client library natively supports the <a href="https://bazel.build/">Bazel</a> and <a href="https://cmake.org/">CMake</a> build systems. We've created a minimal, "Hello world", <a href="https://github.com/googleapis/google-cloud-cpp-spanner/blob/master/quickstart">quickstart repo</a> that includes detailed instructions on how to compile the library for use in your application. You can fetch the source from <a href="https://github.com/googleapis/google-cloud-cpp-spanner" title="GitHub Repository">GitHub</a> as normal:</p>
<div class="fragment"><div class="line">git clone https://github.com/googleapis/google-cloud-cpp-spanner.git</div><div class="line">cd google-cloud-cpp-spanner/quickstart</div></div><!-- fragment --><dl class="section user"><dt>Example: Hello World</dt><dd></dd></dl>
<p>The following shows the code that you'll run in the <code>quickstart/</code> directory, which should give you a taste of the Cloud Spanner C++ client library API.</p>
<div class="fragment"><div class="line"><span class="comment">// Copyright 2020 Google LLC</span></div><div class="line"><span class="comment">//</span></div><div class="line"><span class="comment">// Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);</span></div><div class="line"><span class="comment">// you may not use this file except in compliance with the License.</span></div><div class="line"><span class="comment">// You may obtain a copy of the License at</span></div><div class="line"><span class="comment">//</span></div><div class="line"><span class="comment">// http://www.apache.org/licenses/LICENSE-2.0</span></div><div class="line"><span class="comment">//</span></div><div class="line"><span class="comment">// Unless required by applicable law or agreed to in writing, software</span></div><div class="line"><span class="comment">// distributed under the License is distributed on an &quot;AS IS&quot; BASIS,</span></div><div class="line"><span class="comment">// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</span></div><div class="line"><span class="comment">// See the License for the specific language governing permissions and</span></div><div class="line"><span class="comment">// limitations under the License.</span></div><div class="line"></div><div class="line"><span class="preprocessor">#include &quot;<a class="code" href="client_8h.html">google/cloud/spanner/client.h</a>&quot;</span></div><div class="line"><span class="preprocessor">#include &lt;iostream&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;stdexcept&gt;</span></div><div class="line"></div><div class="line"><span class="keywordtype">int</span> <a class="code" href="samples_8cc.html#adacbe0175a79dff748855d8c9839f82b">main</a>(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span>* argv[]) <span class="keyword">try</span> {</div><div class="line">  <span class="keywordflow">if</span> (argc != 4) {</div><div class="line">    std::cerr &lt;&lt; <span class="stringliteral">&quot;Usage: &quot;</span> &lt;&lt; argv[0]</div><div class="line">              &lt;&lt; <span class="stringliteral">&quot; project-id instance-id database-id\n&quot;</span>;</div><div class="line">    <span class="keywordflow">return</span> 1;</div><div class="line">  }</div><div class="line"></div><div class="line">  <span class="keyword">namespace </span><a class="code" href="namespacegoogle_1_1cloud_1_1spanner.html">spanner</a> = ::google::cloud::spanner;</div><div class="line">  spanner::Client client(</div><div class="line">      <a class="code" href="namespacegoogle_1_1cloud_1_1spanner_1_1v1.html#aef558059b23cddd57ddbb33ac4825ae4">spanner::MakeConnection</a>(spanner::Database(argv[1], argv[2], argv[3])));</div><div class="line"></div><div class="line">  <span class="keyword">auto</span> rows =</div><div class="line">      client.ExecuteQuery(spanner::SqlStatement(<span class="stringliteral">&quot;SELECT &#39;Hello World&#39;&quot;</span>));</div><div class="line"></div><div class="line">  <span class="keywordflow">for</span> (<span class="keyword">auto</span> <span class="keyword">const</span>&amp; row : <a class="code" href="namespacegoogle_1_1cloud_1_1spanner_1_1v1.html#ad575810e64558235b2ca67b9b5e462b8">spanner::StreamOf</a>&lt;std::tuple&lt;std::string&gt;&gt;(rows)) {</div><div class="line">    <span class="keywordflow">if</span> (!row) <span class="keywordflow">throw</span> std::runtime_error(row.status().message());</div><div class="line">    std::cout &lt;&lt; std::get&lt;0&gt;(*row) &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div><div class="line">  }</div><div class="line"></div><div class="line">  <span class="keywordflow">return</span> 0;</div><div class="line">} <span class="keywordflow">catch</span> (std::exception <span class="keyword">const</span>&amp; ex) {</div><div class="line">  std::cerr &lt;&lt; <span class="stringliteral">&quot;Standard exception raised: &quot;</span> &lt;&lt; ex.what() &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div><div class="line">  <span class="keywordflow">return</span> 1;</div><div class="line">}</div></div><!-- fragment --><h2>API Notes</h2>
<p>The following are general notes about using the library.</p>
<h3>Environment Variables</h3>
<p>There are several environment variables that can be set to configure certain behaviors in the library.</p>
<ul>
<li><code>GOOGLE_CLOUD_CPP_ENABLE_CLOG=yes</code> turns on logging in the library, basically the library always "logs" but the logging infrastructure has no backend to actually print anything until the application sets a backend or they set this environment variable.</li>
<li><code>GOOGLE_CLOUD_CPP_ENABLE_TRACING=rpc</code> turns on tracing for most gRPC calls, the library injects an additional Stub decorator that prints each gRPC request and response.</li>
<li><code>GOOGLE_CLOUD_CPP_ENABLE_TRACING=rpc-streams</code> turns on tracing for streaming gRPC calls, such as <code>Client::Read()</code>, <code>Client::ExecutEQuery()</code>, and <code>Client::ProfileQuery()</code>. This can produce a lot of output, so use with caution!</li>
<li><code>GOOGLE_CLOUD_CPP_SPANNER_DEFAULT_ENDPOINT=...</code> changes the default endpoint (spanner.googleapis.com) for the library.</li>
<li><code>GOOGLE_CLOUD_PROJECT=...</code> is used in examples and integration tests to configure the GCP project.</li>
<li><code>GOOGLE_CLOUD_CPP_SPANNER_INSTANCE=...</code> is used in examples and integration tests to, well, configure the spanner instance.</li>
<li><code>GOOGLE_CLOUD_CPP_SPANNER_IAM_TEST_SA=...</code> is used in examples and integration tests to set the service account for testing IAM operations.</li>
<li><code>SPANNER_EMULATOR_HOST=host:port</code> tells the library to connect to the specified emulator rather than the default endpoint.</li>
<li><code>SPANNER_OPTIMIZER_VERSION=n</code> sets the default query optimizer version to use in <code>Client::ExecuteQuery()</code> calls.</li>
</ul>
<h3>Error Handling</h3>
<p>This library never throws exceptions to signal error. In general, the library returns a <a href="https://github.com/googleapis/google-cloud-cpp-common/blob/master/google/cloud/status_or.h"><code>StatusOr&lt;T&gt;</code></a> if an error is possible. Some functions return objects that are not wrapped in a <code>StatusOr&lt;&gt;</code> but will themselves return a <code>StatusOr&lt;T&gt;</code> to signal an error. For example, wrappers for long running operations return <code>future&lt;StatusOr&lt;T&gt;&gt;</code>, and the methods on <code>Client</code> that read from a database return a <code>RowStream</code>, which iterates a stream of <code>StatusOr&lt;T&gt;</code>.</p>
<dl class="section user"><dt>Example</dt><dd></dd></dl>
<p>Applications should check if the <code>StatusOr&lt;T&gt;</code> contains a value before using it, much like how you might check that a pointer is not null before dereferencing it. Indeed, a <code>StatusOr&lt;T&gt;</code> object can be used like a smart-pointer to <code>T</code>, with the main difference being that when it does not hold a <code>T</code> it will instead hold a <code>Status</code> object with extra information about the error.</p>
<p>You can check that a <code>StatusOr&lt;T&gt;</code> contains a value by calling the <code>.ok()</code> method, or by using <code>operator bool()</code> (like with other smart pointers). If there is no value, you can access the contained <code>Status</code> object using the <code>.status()</code> member. If there is a value, you may access it by dereferencing with <code>operator*()</code> or <code>operator-&gt;()</code>. As with all smart pointers, callers must first check that the <code>StatusOr&lt;T&gt;</code> contains a value before dereferencing and accessing the contained value. Alternatively, callers may instead use the <code>.value()</code> member function which is defined to throw a <code>RuntimeStatusError</code> if there is no value.</p>
<dl class="section note"><dt>Note</dt><dd>If you're compiling with exceptions disabled, calling <code>.value()</code> on a <code>StatusOr&lt;T&gt;</code> that does not contain a value will terminate the program instead of throwing.</dd></dl>
<div class="fragment"><div class="line">  <span class="keyword">namespace </span><a class="code" href="namespacegoogle_1_1cloud_1_1spanner.html">spanner</a> = ::google::cloud::spanner;</div><div class="line">  [](spanner::Client client) {</div><div class="line">    <span class="keyword">auto</span> rows = client.Read(<span class="stringliteral">&quot;Albums&quot;</span>, spanner::KeySet::All(), {<span class="stringliteral">&quot;AlbumTitle&quot;</span>});</div><div class="line">    <span class="comment">// The actual type of `row` is google::cloud::StatusOr&lt;spanner::Row&gt;, but</span></div><div class="line">    <span class="comment">// we expect it&#39;ll most often be declared with auto like this.</span></div><div class="line">    <span class="keywordflow">for</span> (<span class="keyword">auto</span> <span class="keyword">const</span>&amp; row : rows) {</div><div class="line">      <span class="comment">// Use `row` like a smart pointer; check it before dereferencing</span></div><div class="line">      <span class="keywordflow">if</span> (!row) {</div><div class="line">        <span class="comment">// `row` doesn&#39;t contain a value, so `.status()` will contain error info</span></div><div class="line">        std::cerr &lt;&lt; row.status();</div><div class="line">        <span class="keywordflow">break</span>;</div><div class="line">      }</div><div class="line"></div><div class="line">      <span class="comment">// The actual type of `song` is google::cloud::StatusOr&lt;std::string&gt;, but</span></div><div class="line">      <span class="comment">// again we expect it&#39;ll be commonly declared with auto as we show here.</span></div><div class="line">      <span class="keyword">auto</span> song = row-&gt;get&lt;std::string&gt;(<span class="stringliteral">&quot;AlbumTitle&quot;</span>);</div><div class="line"></div><div class="line">      <span class="comment">// Instead of checking then dereferencing `song` as we did with `row`</span></div><div class="line">      <span class="comment">// above, here we demonstrate use of the `.value()` member, which will</span></div><div class="line">      <span class="comment">// return a reference to the contained `T` if it exists, otherwise it</span></div><div class="line">      <span class="comment">// will throw an exception (or terminate if compiled without exceptions).</span></div><div class="line">      std::cout &lt;&lt; <span class="stringliteral">&quot;SongName: &quot;</span> &lt;&lt; song.value() &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div><div class="line">    }</div><div class="line">  }</div></div><!-- fragment --> <h3>Retry, Backoff, and Idempotency Policies.</h3>
<p>The library automatically retries requests that fail with transient errors, and follows the recommended practices with respect to backoff between retries. Application developers can override the default <a class="el" href="namespacegoogle_1_1cloud_1_1spanner_1_1v1.html#a0a6f212ac417db25226f570953f8ca0a">retry</a> and <a class="el" href="namespacegoogle_1_1cloud_1_1spanner_1_1v1.html#a82490621a0064a08ed19471b8eee2c1a">backoff</a> policies.</p>
<p>The default policies are to continue retrying for up to 15 minutes, and to use truncated (at 5 minutes) exponential backoff, doubling the maximum backoff period between retries.</p>
<div class="fragment"><div class="line">  <span class="keyword">namespace </span><a class="code" href="namespacegoogle_1_1cloud_1_1spanner.html">spanner</a> = ::google::cloud::spanner;</div><div class="line">  [](std::string <span class="keyword">const</span>&amp; project_id, std::string <span class="keyword">const</span>&amp; instance_id,</div><div class="line">     std::string <span class="keyword">const</span>&amp; database_id) {</div><div class="line">    <span class="keyword">auto</span> client = spanner::Client(<a class="code" href="namespacegoogle_1_1cloud_1_1spanner_1_1v1.html#aef558059b23cddd57ddbb33ac4825ae4">spanner::MakeConnection</a>(</div><div class="line">        spanner::Database(project_id, instance_id, database_id),</div><div class="line">        <a class="code" href="namespacegoogle_1_1cloud_1_1spanner_1_1v1.html#a780db6d7ded7d601844b15fced88b1a4">spanner::ConnectionOptions</a>{}, spanner::SessionPoolOptions{},</div><div class="line">        <span class="comment">// Retry for at most 25 minutes.</span></div><div class="line">        <a class="code" href="namespacegoogle_1_1cloud_1_1spanner_1_1v1.html#add72dc0bb0c129a27bbb1407feef8d5d">spanner::LimitedTimeRetryPolicy</a>(</div><div class="line">            <span class="comment">/*maximum_duration=*/</span>std::chrono::minutes(25))</div><div class="line">            .clone(),</div><div class="line">        <span class="comment">// Use an truncated exponential backoff with jitter to wait between</span></div><div class="line">        <span class="comment">// retries:</span></div><div class="line">        <span class="comment">//   https://en.wikipedia.org/wiki/Exponential_backoff</span></div><div class="line">        <span class="comment">//   https://cloud.google.com/storage/docs/exponential-backoff</span></div><div class="line">        <a class="code" href="namespacegoogle_1_1cloud_1_1spanner_1_1v1.html#afc88c5a7d61b451fac89c920aa5a330c">spanner::ExponentialBackoffPolicy</a>(</div><div class="line">            <span class="comment">/*initial_delay=*/</span>std::chrono::seconds(2),</div><div class="line">            <span class="comment">/*maximum_delay=*/</span>std::chrono::minutes(10),</div><div class="line">            <span class="comment">/*scaling=*/</span>1.5)</div><div class="line">            .clone()));</div><div class="line"></div><div class="line">    <span class="keyword">auto</span> rows =</div><div class="line">        client.ExecuteQuery(spanner::SqlStatement(<span class="stringliteral">&quot;SELECT &#39;Hello World&#39;&quot;</span>));</div><div class="line"></div><div class="line">    <span class="keywordflow">for</span> (<span class="keyword">auto</span> <span class="keyword">const</span>&amp; row : <a class="code" href="namespacegoogle_1_1cloud_1_1spanner_1_1v1.html#ad575810e64558235b2ca67b9b5e462b8">spanner::StreamOf</a>&lt;std::tuple&lt;std::string&gt;&gt;(rows)) {</div><div class="line">      <span class="keywordflow">if</span> (!row) <span class="keywordflow">throw</span> std::runtime_error(row.status().message());</div><div class="line">      std::cout &lt;&lt; std::get&lt;0&gt;(*row) &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div><div class="line">    }</div><div class="line">  }</div></div><!-- fragment --> <dl class="section see"><dt>See also</dt><dd><a class="el" href="namespacegoogle_1_1cloud_1_1spanner_1_1v1.html#add72dc0bb0c129a27bbb1407feef8d5d">LimitedTimeRetryPolicy</a> and <a class="el" href="namespacegoogle_1_1cloud_1_1spanner_1_1v1.html#a57a7da2cd136ebd02af8b57d9bfc196e">LimitedErrorCountRetryPolicy</a> for alternative retry policies.</dd>
<dd>
<a class="el" href="namespacegoogle_1_1cloud_1_1spanner_1_1v1.html#afc88c5a7d61b451fac89c920aa5a330c">ExponentialBackoffPolicy</a> to configure different parameters for the exponential backoff policy.</dd></dl>
<h2>Next Steps</h2>
<p><a class="el" href="spanner-mocking.html">Mocking the Cloud Spanner C++ Client with Google Mock</a> </p>
</div></div><!-- PageDoc -->
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.15
</small></address>
</body>
</html>
